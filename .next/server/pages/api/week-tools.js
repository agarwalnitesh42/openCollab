"use strict";(()=>{var e={};e.id=3804,e.ids=[3804],e.modules={20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},72349:(e,t,a)=>{a.r(t),a.d(t,{config:()=>_,default:()=>c,routeModule:()=>m});var r={};a.r(r),a.d(r,{default:()=>d});var s=a(71802),i=a(47153),n=a(56249);let o=require("@supabase/supabase-js");class u{constructor(){this.supabase=(0,o.createClient)("https://saabvxfsdpnrfhchurch.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}async getWeekNumber(e,t){let{data:a,error:r}=await this.supabase.rpc("get_week_number",{date_in:e,start_day:t});if(null!==r)throw Error(r.message);return a}async getPrevLaunchWeeks(e,t,a,r=1){let{data:s,error:i}=await this.supabase.rpc("get_prev_launch_weeks",{_year:e,_start_day:t,_launch_week:a,_limit:r});if(null!==i)throw Error(i.message);let n=s.map(e=>({week:e.week,startDate:new Date(e.start_date),endDate:new Date(e.end_date),products:(e.products||[]).map(e=>({...e.product,product_pricing_types:e.product_pricing_types,product_categories:e.product_categories}))}));return await Promise.all(n.map(async e=>{await Promise.all(e.products.map(async e=>{if(!e.owner_id)return;let t=await this.supabase.auth.admin.getUserById(e.owner_id);e.email=t.data.user?.email}))})),n}}var l=a(79625);async function d(e,t){let{week:a,limit:r=3,year:s=new Date().getFullYear(),key:i}=e.query;if(i!==process.env.API_KEY)throw Error("Forbidden");let n=+a;if(a&&Number.isNaN(n))return t.status(400).json({message:"Please provide week number as number"});let o=new u,d=new Date,p=await o.getWeekNumber(d,2);-1===n&&(n=p>1?p-1:52,s=p>1?d.getFullYear():d.getFullYear()-1),n||(n=p);let c=await o.getPrevLaunchWeeks(s,2,n,1);if(!c||0===c.length)return[];let{products:_}=c[0],m=_.slice(0,r);t.json(m.map(l.simpleToolApiDtoFormatter))}let p=s.PagesAPIRouteModule,c=(0,n.l)(r,"default"),_=(0,n.l)(r,"config"),m=new p({definition:{kind:i.x.PAGES_API,page:"/api/week-tools",pathname:"/api/week-tools",bundlePath:"",filename:""},userland:r})},79625:(e,t,a)=>{function r(e){return{id:e.id,email:e.email,name:e.name,description:e.description,logo_url:e.logo_url,data_added:new Date(e.created_at).toISOString().split("T")[0],launch_date:e.launch_date,votes_count:e.votes_count||"-",devhunt_link:`https://opencollab.exchange/tool/${e.slug}`,link:e.demo_url}}a.r(t),a.d(t,{simpleToolApiDtoFormatter:()=>r})}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[4222],()=>a(72349));module.exports=r})();